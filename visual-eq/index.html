<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio Visualizer - Enhanced</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body class="dark">
    <div id="app" class="app">
      <!-- Header -->
      <header class="header">
        <h1>Audio Visualizer</h1>
        <div class="header-controls">
          <button id="fullscreen-btn" class="icon-button" aria-label="Toggle fullscreen">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
            </svg>
          </button>
          <button id="settings-btn" class="icon-button" aria-label="Settings">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97 0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1 0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
            </svg>
          </button>
        </div>
        <p id="status-message" class="status"></p>
      </header>

      <!-- Control Panel -->
      <aside class="controls" id="controls-panel">
        <div class="controls-header">
          <h2>Controls</h2>
          <button id="collapse-controls" class="icon-button" aria-label="Collapse controls">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
            </svg>
          </button>
        </div>

        <!-- Global Controls -->
        <section class="control-section" id="global-controls">
          <h3 class="section-title">Audio Source</h3>
          
          <!-- Input Selector -->
          <div class="control-group">
            <div id="input-selector" class="input-selector">
              <label class="radio-card">
                <input type="radio" name="source" value="mic" checked />
                <div class="radio-content">
                  <span class="radio-icon">üé§</span>
                  <span>Microphone</span>
                </div>
              </label>
              <label class="radio-card">
                <input type="radio" name="source" value="file" />
                <div class="radio-content">
                  <span class="radio-icon">üìÅ</span>
                  <span>Audio File</span>
                </div>
              </label>
            </div>
            
            <!-- File Upload Area -->
            <input type="file" id="file-input" accept="audio/*" style="display: none;" />
            <div id="file-upload-area" class="file-upload-area" style="display: none;">
              <div class="drag-drop-area" id="drag-drop-area">
                <div class="upload-icon">üìé</div>
                <button id="browse-file" type="button" class="browse-button">
                  Choose Audio File
                </button>
                <p class="file-hint">or drag and drop here</p>
                <p class="file-formats">MP3, WAV, OGG, AAC, FLAC, M4A</p>
              </div>
            </div>
            
            <!-- File Info -->
            <div id="file-info" class="file-info" style="display: none;">
              <div class="file-details">
                <span class="file-icon">üéµ</span>
                <div class="file-text">
                  <span id="file-name" class="file-name"></span>
                  <span class="file-size" id="file-size"></span>
                </div>
              </div>
              <button id="change-file" type="button" class="change-file-btn">Change</button>
            </div>
          </div>

          <!-- Global Settings -->
          <div class="control-group">
            <label for="sensitivity-slider">Sensitivity</label>
            <div class="slider-container">
              <input type="range" id="sensitivity-slider" min="0.1" max="3.0" step="0.1" value="1.0" />
              <span class="slider-value">1.0</span>
            </div>
          </div>

          <div class="control-group">
            <label for="theme-selector">Theme</label>
            <select id="theme-selector" class="select-input">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
              <option value="neon">Neon</option>
              <option value="aurora">Aurora</option>
            </select>
          </div>

          <div class="control-group">
            <button id="playback-button" class="primary-button">üé§ Start</button>
          </div>
        </section>

        <!-- Visualization Mode Selection -->
        <section class="control-section" id="mode-selection">
          <h3 class="section-title">Visualization Mode</h3>
          
          <div class="mode-selector-grid">
            <button class="mode-card active" data-mode="bars">
              <div class="mode-preview bars-preview">
                <div class="bar" style="height: 20%"></div>
                <div class="bar" style="height: 60%"></div>
                <div class="bar" style="height: 40%"></div>
                <div class="bar" style="height: 80%"></div>
                <div class="bar" style="height: 30%"></div>
              </div>
              <span class="mode-name">Frequency Bars</span>
            </button>
            
            <button class="mode-card" data-mode="mandala">
              <div class="mode-preview mandala-preview">
                <div class="mandala-ring"></div>
                <div class="mandala-ring"></div>
                <div class="mandala-ring"></div>
              </div>
              <span class="mode-name">Mandala</span>
            </button>
          </div>
          
          <!-- Hidden select for compatibility -->
          <select id="viz-mode" style="display: none;">
            <option value="bars">Frequency Bars</option>
            <option value="mandala">Mandala</option>
          </select>
        </section>

        <!-- Bar Controls -->
        <section class="control-section mode-controls" id="bar-controls">
          <h3 class="section-title">Bar Settings</h3>
          
          <div class="control-group">
            <label for="bar-count-slider">Bar Count</label>
            <div class="slider-container">
              <input type="range" id="bar-count-slider" min="16" max="128" step="8" value="64" />
              <span class="slider-value">64</span>
            </div>
          </div>
          
          <div class="control-group">
            <label for="bar-color-mode">Color Mode</label>
            <select id="bar-color-mode" class="select-input">
              <option value="theme">Theme Colors</option>
              <option value="frequency">Frequency-based</option>
              <option value="rainbow">Rainbow</option>
              <option value="amplitude">Amplitude-based</option>
            </select>
          </div>

          <div class="control-group">
            <label for="bar-visual-mode">Visual Mode</label>
            <select id="bar-visual-mode" class="select-input">
              <option value="standard">Standard</option>
              <option value="wave">Wave Overlay</option>
              <option value="mirror">Mirror</option>
              <option value="3d">3D Perspective</option>
              <option value="peak-hold">Peak Hold</option>
            </select>
          </div>
        </section>

        <!-- Mandala Controls -->
        <section class="control-section mode-controls" id="mandala-controls" style="display: none;">
          <h3 class="section-title">Mandala Settings</h3>
          
          <div class="control-group">
            <label for="mandala-segments">Segments</label>
            <div class="slider-container">
              <input type="range" id="mandala-segments" min="8" max="64" step="8" value="32" />
              <span class="slider-value">32</span>
            </div>
          </div>
          
          <div class="control-group">
            <label for="mandala-rings">Rings</label>
            <div class="slider-container">
              <input type="range" id="mandala-rings" min="3" max="8" step="1" value="4" />
              <span class="slider-value">4</span>
            </div>
          </div>
          
          <div class="control-group">
            <label for="mandala-rotation">Rotation Speed</label>
            <div class="slider-container">
              <input type="range" id="mandala-rotation" min="0" max="10" step="0.5" value="2.0" />
              <span class="slider-value">2.0¬∞/s</span>
            </div>
          </div>
          
          <div class="control-group">
            <label for="mandala-palette">Color Palette</label>
            <select id="mandala-palette" class="select-input">
              <option value="aurora">Aurora</option>
              <option value="solar">Solar</option>
              <option value="crystal">Crystal</option>
              <option value="psychedelic">Psychedelic</option>
              <option value="monochrome">Monochrome</option>
            </select>
          </div>
          
          <div class="control-group">
            <label for="mandala-symmetry">Symmetry</label>
            <select id="mandala-symmetry" class="select-input">
              <option value="none">None</option>
              <option value="mirror-x">Mirror X</option>
              <option value="mirror-y">Mirror Y</option>
              <option value="radial-2x">Radial 2x</option>
              <option value="radial-4x">Radial 4x</option>
              <option value="radial-8x">Radial 8x</option>
              <option value="kaleidoscope">Kaleidoscope</option>
            </select>
          </div>
        </section>
      </aside>

      <!-- Main Visualization Area -->
      <main class="visualizer">
        <canvas id="visualizer" width="800" height="450"></canvas>
        
        <!-- Performance Monitor -->
        <div class="performance-monitor" id="performance-monitor">
          <div class="fps-counter">
            <span class="label">FPS:</span>
            <span id="fps-value">0</span>
          </div>
          <div class="render-time">
            <span class="label">Render:</span>
            <span id="render-time">0ms</span>
          </div>
        </div>
      </main>

      <!-- Mobile Controls Bottom Sheet -->
      <div class="mobile-controls" id="mobile-controls">
        <div class="mobile-handle"></div>
        <div class="mobile-content">
          <h3>Quick Controls</h3>
          <div class="mobile-control-row">
            <button class="mobile-button" id="mobile-play">‚ñ∂</button>
            <button class="mobile-button" id="mobile-mode">üé®</button>
            <button class="mobile-button" id="mobile-theme">üåì</button>
            <button class="mobile-button" id="mobile-settings">‚öôÔ∏è</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>